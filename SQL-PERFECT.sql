USE master
IF(EXISTS(SELECT *FROM SYSDATABASES WHERE NAME='QLSP'))
DROP DATABASE QLSP
GO 
CREATE DATABASE QLSP
GO
USE QLSP
CREATE TABLE NSX(
MANSX CHAR(20) NOT NULL PRIMARY KEY,
TENNSX CHAR(20),
DIACHI CHAR(20)
)

CREATE TABLE SANPHAM(
MASP CHAR(20) NOT NULL PRIMARY KEY,
TENSP CHAR(20),
MAU CHAR(20),
SOLUONG INT,
GIABAN MONEY
)

CREATE TABLE CUNGCAP(
MANSX CHAR(20) NOT NULL,
MASP CHAR(20) NOT NULL,
SLCC INT,
NGAYCC DATE,
CONSTRAINT PK_SX_SP PRIMARY KEY (MANSX,MASP),
CONSTRAINT FK_SX FOREIGN KEY (MANSX) REFERENCES NSX(MANSX) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FK_SP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP) ON UPDATE CASCADE ON DELETE CASCADE
)
INSERT INTO NSX VALUES
(N'5',N'SS',N'VINHPHUC'),
(N'6',N'LG',N'HANOI'),
(N'17',N'TCL',N'HANAM')

INSERT INTO SANPHAM VALUES
(N'1',N'MAYCHIEU',N'TRANG',50,80000),
(N'2',N'TULANH',N'XANH',100,80000),
(N'3',N'DIEUHOA',N'TRANG',50,50000)

INSERT INTO CUNGCAP VALUES
(N'5',N'2',5,'2021-2-12'),
(N'5',N'3',15,'2021-2-12'),
(N'6',N'1',20,'2022-6-2'),
(N'17',N'3',10,'2021-9-2'),
(N'17',N'1',20,'2021-9-2')
SELECT * FROM NSX
SELECT * FROM SANPHAM
SELECT * FROM CUNGCAP

--1
SELECT TENNSX FROM NSX
WHERE DIACHI LIKE 'HANOI'

--2
INSERT INTO SANPHAM VALUES
(N'4',N'DIEUHOA',N'TRANG',50,9000000)
UPDATE SANPHAM 
SET SANPHAM.TENSP = 'CASIO' , SANPHAM.MAU ='DO'
WHERE SANPHAM.MASP = 4
SELECT * FROM SANPHAM
SELECT TENSP, MAU FROM SANPHAM
WHERE GIABAN > 8000000

--3
SELECT TENSP FROM SANPHAM
WHERE SOLUONG >50

--4
SELECT TENSP FROM SANPHAM
INNER JOIN CUNGCAP ON SANPHAM.MASP = CUNGCAP.MASP
WHERE YEAR(NGAYCC) = 2021

--5
SELECT TENSP FROM SANPHAM
INNER JOIN CUNGCAP ON SANPHAM.MASP = CUNGCAP.MASP
INNER JOIN NSX ON CUNGCAP.MANSX = NSX.MANSX
WHERE NSX.TENNSX LIKE'LG'

--6
SELECT * FROM NSX
SELECT TENSP, GIABAN FROM SANPHAM
INNER JOIN CUNGCAP ON SANPHAM.MASP = CUNGCAP.MASP
INNER JOIN NSX ON CUNGCAP.MANSX = NSX.MANSX
WHERE NSX.TENNSX LIKE '[H]%'

--7
SELECT TENNSX FROM NSX
INNER JOIN CUNGCAP ON NSX.MANSX = CUNGCAP.MANSX
INNER JOIN SANPHAM ON CUNGCAP.MASP = SANPHAM.MASP
WHERE SANPHAM.MAU LIKE 'TRANG'
GROUP BY TENNSX

--8
SELECT * FROM CUNGCAP
SELECT SUM(SLCC) AS SOSPDABAN_2022 FROM CUNGCAP
WHERE YEAR(NGAYCC) = 2022

--9
SELECT TOP 2 TENSP FROM SANPHAM
INNER JOIN CUNGCAP ON SANPHAM.MASP = CUNGCAP.MASP
ORDER BY SLCC DESC

--10
SELECT * FROM SANPHAM
SELECT TENSP FROM SANPHAM
INNER JOIN CUNGCAP ON SANPHAM.MASP = CUNGCAP.MASP
INNER JOIN NSX ON CUNGCAP.MANSX = NSX.MANSX
WHERE DIACHI LIKE 'HANAM'
GROUP BY TENSP
HAVING  SUM(SANPHAM.GIABAN) < 10000000

