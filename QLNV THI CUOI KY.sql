CREATE DATABASE QLNV
USE QLNV
GO

CREATE TABLE NHANVIEN(
 MANV CHAR(20) PRIMARY KEY NOT NULL,
 TENNV CHAR(30) NOT NULL,
 NGAYSINH DATE,
 TRINHDO CHAR(20),
 CHUCVU CHAR(20)
)

CREATE TABLE KHOAHOC(
 MAKH CHAR(20) PRIMARY KEY NOT NULL,
 TENKH CHAR(20),
 DIADIEM CHAR(20)
)

CREATE TABLE THAMGIA(
 MANV CHAR(20) NOT NULL FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV) ON UPDATE CASCADE ON DELETE CASCADE,
 MAKH CHAR(20) NOT NULL FOREIGN KEY(MAKH) REFERENCES KHOAHOC(MAKH) ON UPDATE CASCADE ON DELETE CASCADE,
 SOBUOINGHI INT,
 KETQUA CHAR(20)
 CONSTRAINT PK PRIMARY KEY(MANV, MAKH)
)

INSERT INTO NHANVIEN VALUES
('NV01', N'TRAN VAN UOC', '12-5-1988', 'DAI HOC', 'NHAN VIEN'),
('NV02', N'HOANG VAN HUY', '12-17-2000', 'DAI HOC', 'TRUONG PHONG'),
('NV03', N'NGUYEN THI CHINH', '2-5-1982', 'CAO DANG', 'NHAN VIEN')

INSERT INTO KHOAHOC VALUES
('KH01', 'GIAO TIEP CO BAN', 'HA NOI'),
('KH02', 'GIAO TIEP NANG CAO', 'HA NOI'),
('KH03', 'PHAN TICH SO LIEU', 'HO CHI MINH')

INSERT INTO THAMGIA VALUES
('NV01', 'KH01', 1, 'KHA'),
('NV01', 'KH02', 2, 'KHA'),
('NV02', 'KH01', 0, 'GIOI'),
('NV02', 'KH02', 1, 'KHA'),
('NV02', 'KH03', 1, 'TRUNG BINH'),
('NV03', 'KH01', 4, 'TRUNG BINH')

SELECT * FROM NHANVIEN
SELECT * FROM KHOAHOC
SELECT * FROM THAMGIA
--a Lay ra tu co so du lieu ten cac nhan vien co trinh do dai hoc.
SELECT * FROM NHANVIEN
SELECT TENNV FROM NHANVIEN
WHERE TRINHDO LIKE 'DAI HOC'

--b Dua ra thong tin cac nhan vien ho ‘Tran’ sinh nam 2000
SELECT * FROM NHANVIEN

SELECT * FROM NHANVIEN
WHERE TENNV LIKE 'TRAN%' AND YEAR(NGAYSINH) = 2000

--C Lay ra ten cac nhan vien tham gia khoa hoc Giao tiep nang cao co ket qua Kha
SELECT * FROM NHANVIEN
SELECT TENNV FROM NHANVIEN
INNER JOIN THAMGIA ON NHANVIEN.MANV = THAMGIA.MANV
INNER JOIN KHOAHOC ON KHOAHOC.MAKH = THAMGIA.MAKH
WHERE TENKH LIKE 'GIAO TIEP NANG CAO' AND KETQUA LIKE 'KHA'

--D Dua ra thong tin cac nhan vien tham gia cac khoa hoc o Ha Noi co so buoi nghi hoc nhieu hon 2
SELECT NHANVIEN.MANV, TENNV FROM NHANVIEN
INNER JOIN THAMGIA ON NHANVIEN.MANV = THAMGIA.MANV
INNER JOIN KHOAHOC ON KHOAHOC.MAKH = THAMGIA.MAKH
WHERE DIADIEM LIKE 'HA NOI' AND SOBUOINGHI > 2

--E Lay ra ma nhan vien, ten nhan vien, so buoi nghi va ket qua cua cac nhan vien tham gia cac khoa hoc ve giao tiep.
SELECT NHANVIEN.MANV, TENNV, SOBUOINGHI, KETQUA FROM THAMGIA
INNER JOIN NHANVIEN ON NHANVIEN.MANV = THAMGIA.MANV
INNER JOIN KHOAHOC ON KHOAHOC.MAKH = THAMGIA.MAKH
WHERE TENKH LIKE 'GIAO TIEP%'

--F Dua ra danh sach ma khoa hoc, ten khoa hoc, so nguoi tham gia ket qua gioi trong moi khoa
SELECT KHOAHOC.MAKH, TENKH, COUNT(MANV) AS SONGUOI_GIOI FROM KHOAHOC
INNER JOIN THAMGIA ON KHOAHOC.MAKH = THAMGIA.MAKH
WHERE KETQUA LIKE'GIOI'
GROUP BY KHOAHOC.MAKH, TENKH

--G Lay ra ma nhan vien va so khoa hoc nhan vien do da tham gia.
SELECT NHANVIEN.MANV, COUNT(THAMGIA.MAKH) AS SOKHTG FROM NHANVIEN
INNER JOIN THAMGIA ON NHANVIEN.MANV = THAMGIA.MANV
GROUP BY NHANVIEN.MANV

--H  Lay ra ma va ten cac khoa hoc co tu 2 nhan vien tro len tham gia hoc.
SELECT * FROM KHOAHOC
SELECT * FROM THAMGIA

SELECT KHOAHOC.MAKH, TENKH FROM KHOAHOC
INNER JOIN THAMGIA ON KHOAHOC.MAKH = THAMGIA.MAKH
GROUP BY KHOAHOC.MAKH, TENKH 
HAVING COUNT(THAMGIA.MANV) >=2

--I  Dua ra thong tin nhieu tuoi nhat khoa hoc ‘Phan tich so lieu’
SELECT NHANVIEN.MANV, TENNV, TRINHDO FROM NHANVIEN
INNER JOIN THAMGIA ON NHANVIEN.MANV = THAMGIA.MANV
INNER JOIN KHOAHOC ON KHOAHOC.MAKH = THAMGIA.MAKH
WHERE NGAYSINH = (SELECT MIN(NGAYSINH) FROM NHANVIEN) AND TENKH LIKE'PHAN TICH SO LIEU'

--J  Lay ra ma va ten nhan vien da tham gia tat ca cac khoa hoc.
INSERT INTO THAMGIA VALUES 
('NV01', 'KH03',5,'TRUNG BINH')
SELECT * FROM THAMGIA

SELECT NHANVIEN.MANV, TENNV  FROM NHANVIEN
INNER JOIN THAMGIA ON NHANVIEN.MANV = THAMGIA.MANV
GROUP BY NHANVIEN.MANV, TENNV
HAVING COUNT(MAKH)= (SELECT COUNT(MAKH) FROM KHOAHOC)

--K Dua ra nhan vien khong tham gia khoa hoc nao
SELECT NHANVIEN.MANV, TENNV FROM NHANVIEN
WHERE NHANVIEN.MANV NOT IN( SELECT MANV FROM THAMGIA)

--L Dua ra nhan vien tham gia nhieu khoa hoc nhat
SELECT MANV, COUNT(MAKH) AS SLKH FROM THAMGIA
GROUP BY MANV
HAVING COUNT(MAKH) = ( 
					SELECT MAX(SLKH) 
					FROM (SELECT MANV, COUNT(MAKH) AS SLKH FROM THAMGIA
						 GROUP BY MANV) AS THONGKEKHOAHOC
)
--M Dua ra khoa hoc khong co hoc vien nao hoc luc ‘Kem’
INSERT INTO THAMGIA VALUES 
('NV03', 'KH03',6,'KEM')
SELECT * FROM THAMGIA
SELECT MAKH FROM THAMGIA
WHERE KETQUA NOT IN('KEM')
GROUP BY MAKH

--N	Dua ra nhan vien co so buoi nghi hoc nhieu nhat
SELECT MANV, SOBUOINGHI FROM THAMGIA
WHERE SOBUOINGHI = (SELECT MAX(SOBUOINGHI) FROM THAMGIA)
